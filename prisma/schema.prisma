generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Vehicle {
  v_id         Int           @id @default(autoincrement())
  name         String
  description  String
  imageUrl     String
  price        Float
  categoryId   Int
  categoryName String
  category     Category      @relation(fields: [categoryId, categoryName], references: [c_id, name])
  BookingInfo  BookingInfo[]
}

model Category {
  c_id        Int           @id @default(autoincrement())
  name        String        @unique
  description String
  imageUrl    String
  price       Float
  vehicles    Vehicle[]
  Bookings    BookingInfo[]

  @@unique([c_id, name])
  @@map("category")
}

model User {
  userId      Int           @id @default(autoincrement())
  username    String        @unique
  email       String        @unique
  password    String
  role        Role          @default(user)
  createdAt   DateTime      @default(now())
  updateAt    DateTime      @default(now())
  Login       Login[]
  BookingInfo BookingInfo[]

  @@map("user")
}

model Admin {
  adminId     Int           @id @default(autoincrement())
  ownername   String        @unique
  email       String        @unique
  passowrd    String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt()
  role        Role          @default(admin)
  Login       Login[]
  BookingInfo BookingInfo[]

  @@map("admin")
}

enum Role {
  user
  admin
  superadmin
}

model Login {
  loginId      Int    @id @default(autoincrement())
  userId       Int?
  user         User?  @relation(fields: [userId], references: [userId])
  adminId      Int?
  admin        Admin? @relation(fields: [adminId], references: [adminId])
  refreshToken String @unique
  email        String
  password     String
  role         Role

  @@map("login")
}

model BookingInfo {
  bookingId      Int            @id @default(autoincrement())
  username       String
  ownername      String
  bookingDate    DateTime
  returnDate     DateTime
  useremail      String
  vehicleId      Int
  categoryId     Int
  price          String
  pickuplocation String
  droplocation   String
  paymentMethod  PayemntMethod  @default(cashOnDelivery)
  paymentStatus  Payment        @default(pending)
  deliverystatus DeliveryStatus @default(pending)
  vehicle        Vehicle        @relation(fields: [vehicleId], references: [v_id])
  User           User           @relation(fields: [useremail], references: [email])
  admin          Admin          @relation(fields: [ownername], references: [ownername])
  category       Category       @relation(fields: [categoryId], references: [c_id])

  @@map("booking")
}

enum Payment {
  pending
  hold
  completed
}

enum DeliveryStatus {
  pending
  dilivered
  cancled
}

enum PayemntMethod {
  eSewa
  khalti
  fonePay
  cashOnDelivery
}
